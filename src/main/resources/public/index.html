<!doctype html>

<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <title>iFellTower - Tic Tac Toe</title>
    <meta name="game" content="Tic Tac Toe">
    <meta name="iFellTower" content="SitePoint">



</head>

<body>
    <h1>iFellTower's Tic Tac Toe</h1>
    <table id="TTTtable">
        <tr>
            <td id="1" class="tile" value="Hello"></td>
            <td id="2" class="tile"></td>
            <td id="3" class="tile"></td>
        </tr>
        <tr>
            <td id="4" class="tile"></td>
            <td id="5" class="tile"></td>
            <td id="6" class="tile"></td>
        </tr>
        <tr>
            <td id="7" class="tile"></td>
            <td id="8" class="tile"></td>
            <td id="9" class="tile"></td>
        </tr>
    </table>

    <h3>Wins<h3>
    <p>Player X: <span id="playerX"> 0 </span></p>
    <p>Player O: <span id="playerO"> 0 </span></p>
</body>

<script>

    /*$(document).ready( function() {
        newGame();
    });*/

    $("#TTTtable").on("click", "td", function() {
        /// If someone clicks a tile we get the ID of the tile
        var tile = $(this).attr('id');
        /// Check if the tile is already chosen
        if($(this).html() != "X" && $(this).html() != "O"){
            /// Build a post request to make a move
            makeMove(tile);
            checkWinner();
        } else {
            // TODO: print an error message for tile has value
        }

        getScores();
    });
    /// Check if there is a winner
    /*checkWinner();
    getScores();*/

    function makeMove(tile){
        $.ajax({
            type: 'POST',
            url: '/makeMove',
            data: {
                'tile': tile
            }
        }).done(function(success) {
            var move = JSON.parse(success);
            console.log("I wrote down player " + move.player);
            document.getElementById(tile).innerHTML = move.player;
            /// After we make the move we need to change the player
        }).fail(function() {
            console.log("Could not make move");
        });
    }

    function newGame(){
        $.ajax({
            type: 'POST',
            url: '/newGame'
        });
        /// clear table
        for(var i = 1; i <= 9; i++){
            document.getElementById(i).innerHTML = "";
        }
    }

    function checkWinner(){
        $.ajax({
            type: 'GET',
            url: '/checkWinner'
        }).done(function(success) {
            console.log(success);
            // TODO: if there is a winner, announce it and clear board
            var winner = JSON.parse(success);
            if(winner.status === true){
                alert("Congrats to player " + winner.player + ", for winnig the game");
                newGame();
            } else {
                changePlayer();
            }
        }).fail(function(){
            console.log("Check winner function failed");
        });
    }

    function getScores(){
        $.ajax({
            type: 'GET',
            url: '/getScores'
        }).done(function(scores) {
            console.log(scores);
            // TODO: update html with current score
            var score = JSON.parse(scores);
            document.getElementById('playerX').innerHTML = score.playerX;
            document.getElementById('playerO').innerHTML = score.playerO;
        }).fail(function(){
            console.log("Could not get scores");
        });
    }

    function changePlayer(){
        $.ajax({
            type: 'POST',
            url: '/changePlayer'
        }).done(function(){
            console.log("playerChanged");
        }).fail(function() {
            console.log("-- Could not change player");
        });
    };

</script>

</html>
